2024-12-02 16:26:14 - INFO - Starting execution from planning phase
2024-12-02 16:26:14 - INFO - Starting Planning Phase
2024-12-02 16:26:14 - INFO - Read user specifications
2024-12-02 16:26:14 - INFO - Sending prompt using qwen2.5-coder:32b-instruct-q4_K_M in planning phase
2024-12-02 16:26:14 - INFO - Prompt content: Take the below rough specifications, clean them up, and write them as you would write professional specifications 
                             to be handed to a software developer. Take your time, and be as detailed as possible:

                        -- SPECS BELOW --

                        Using Python and FastAPI, you must build an API with 1 endpoint. It is defined below:

1. Transcribe - Accepts an input stream of wav audio data. This endpoint will use Faster Whisper with the repo/model: "deepdml/faster-whisper-large-v3-turbo-ct2". The parameters for this model are below:
    - Compute Type: int8_float16.
    - Device: "cuda".
As the audio data stream is received, the chunks should be appended to an audio_buffer - which should happen continuously until this API call is complete. FasterWhisper comes bundled with the Silero VAD model for detecting human speech, and this should be used to detect speech. When speech is FIRST detected in the incoming audio stream, a speech_detected boolean should be set to True. From this point on:
    -   If speech is NOT detected for a continuous period of 200ms or longer, and a boolean called processed is set to false, the audio_buffer data should be transcribed by the model and stored in a result variable. The boolean processed should then be set to true.
    -   If speech is detected before 800ms of no speech pass: processed should be set to false, and if a transcription is currently in progress, it should be canceled. Audio then continues to be received and appended to the buffer until another 200ms of no speech occurs.
    -   If 800ms of no speech pass: the last transcription result should be returned to the user as a text response. If the transcription is still going, wait for it, and then return it once completed. At this point, it doesn't matter if speech is detected again.
    -   If the audio input stream ends at any point, then none of the above speech detection logic applies: the audio_buffer should be passed to the model to transcribe, and - once finished - the result should be returned to the client/user.

Additional API Details:

- Ensure that the model is downloaded into a "models" subdirectory if it doesn't already exist, and load it from there. 
- The model should be loaded when the API starts up, and only one instance should be used.
- Access to this API should be by API key - which should be stored in a dict on the server. Handle authentication by API key for the endpoint - returning appropriate errors if not present or correct.



2024-12-02 16:26:23 - INFO - HTTP Request: POST http://192.168.50.13:11434/api/chat "HTTP/1.1 200 OK"
2024-12-02 16:26:23 - ERROR - Error with API call: 'dict' object has no attribute 'choices'
2024-12-02 16:26:23 - ERROR - An unexpected error occurred: Traceback (most recent call last):
  File "C:\Users\raisbecka\vscode\o1_Melvin\main.py", line 225, in send_prompt
    response_content = model.prompt(prompt)
  File "C:\Users\raisbecka\vscode\o1_Melvin\models\ollama.py", line 40, in prompt
    if chunk.choices[0].delta.content is not None:
AttributeError: 'dict' object has no attribute 'choices'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\raisbecka\vscode\o1_Melvin\main.py", line 531, in main
    planning_phase(r)
  File "C:\Users\raisbecka\vscode\o1_Melvin\main.py", line 277, in planning_phase
    final_specs = send_prompt(prompt, "planning").raw_text
  File "C:\Users\raisbecka\vscode\o1_Melvin\main.py", line 235, in send_prompt
    raise Exception(error_msg)
Exception: Error with API call: 'dict' object has no attribute 'choices'

